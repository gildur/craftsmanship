buildscript {
    repositories {
        jcenter()
    }
    dependencies {
        classpath 'com.bmuschko:gradle-docker-plugin:3.0.11'
    }
}

apply plugin: com.bmuschko.gradle.docker.DockerRemoteApiPlugin

import com.bmuschko.gradle.docker.tasks.image.*

task createDockerfile(type: Dockerfile) {
    destFile = project.file('build/Dockerfile')
    from 'openjdk:8'
    maintainer 'Piotr Wolny "gildur@gmail.com"'
    copyFile "libs/${jar.archiveName}", "."
    defaultCommand "java", "-jar", jar.archiveName
    exposePort 8080
}

task buildImage(type: DockerBuildImage) {
    dependsOn createDockerfile
    inputDir = createDockerfile.destFile.parentFile
    tag = "500408330564.dkr.ecr.us-east-2.amazonaws.com/craftsmanship:${version}"
}
buildImage.dependsOn build
